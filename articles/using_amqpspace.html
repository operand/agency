<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=G-76DYGNV0GJ"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-76DYGNV0GJ'); </script> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="icon" href="/favicon.ico" type="image/x-icon"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Using AMQPSpace | Agency</title> <meta name="generator" content="Jekyll v3.9.3" /> <meta property="og:title" content="Using AMQPSpace" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Using AMQPSpace" /> <meta property="og:description" content="Using AMQPSpace" /> <link rel="canonical" href="https://createwith.agency/articles/using_amqpspace" /> <meta property="og:url" content="https://createwith.agency/articles/using_amqpspace" /> <meta property="og:site_name" content="Agency" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2023-08-17T23:12:03+00:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Using AMQPSpace" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-08-17T23:12:03+00:00","datePublished":"2023-08-17T23:12:03+00:00","description":"Using AMQPSpace","headline":"Using AMQPSpace","mainEntityOfPage":{"@type":"WebPage","@id":"https://createwith.agency/articles/using_amqpspace"},"url":"https://createwith.agency/articles/using_amqpspace"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> Agency </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/articles/walkthrough" class="nav-list-link">Example Application Walkthrough</a></li><li class="nav-list-item"><a href="/articles/agent_implementation" class="nav-list-link">Agent Implementation</a></li><li class="nav-list-item"><a href="/articles/messaging" class="nav-list-link">Messaging</a></li><li class="nav-list-item active"><a href="/articles/using_amqpspace" class="nav-list-link active">Using AMQPSpace</a></li></ul> </nav> &nbsp </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Agency" aria-label="Search Agency" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://github.com/operand/agency" class="site-button" target="_blank" rel="noopener noreferrer" > Agency on Github </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content"> <main> <h1 id="using-amqpspace"> <a href="#using-amqpspace" class="anchor-heading" aria-labelledby="using-amqpspace"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Using AMQPSpace </h1> <p>To use AMQP for multi-process or networked communication, you can simply swap the <code class="language-plaintext highlighter-rouge">AMQPSpace</code> class for the <code class="language-plaintext highlighter-rouge">NativeSpace</code> class.</p> <p>Then to take advantage of parallelism, you would also separate your agents into multiple processes configured to use the same AMQP server.</p> <p>For example, the following would separate the <code class="language-plaintext highlighter-rouge">Host</code> agent into its own application:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>

    <span class="c1"># Create a space
</span>    <span class="n">space</span> <span class="o">=</span> <span class="n">AMQPSpace</span><span class="p">()</span>

    <span class="c1"># Add a host agent to the space
</span>    <span class="n">space</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Host</span><span class="p">(</span><span class="s">"Host"</span><span class="p">))</span>

    <span class="c1"># keep alive
</span>    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div> <p>And the following would separate the <code class="language-plaintext highlighter-rouge">ChattyAI</code> agent into its own application:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>

    <span class="c1"># Create a space
</span>    <span class="n">space</span> <span class="o">=</span> <span class="n">AMQPSpace</span><span class="p">()</span>

    <span class="c1"># Add a simple HF based chat agent to the space
</span>    <span class="n">space</span><span class="p">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">ChattyAI</span><span class="p">(</span><span class="s">"Chatty"</span><span class="p">,</span>
                 <span class="n">model</span><span class="o">=</span><span class="s">"EleutherAI/gpt-neo-125m"</span><span class="p">))</span>

    <span class="c1"># keep alive
</span>    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div> <p>Make sure to reuse the same AMQP server and configuration for both applications.</p> <p>Then you can run both applications at the same time, and the agents will be able to connect and communicate with each other over AMQP. This approach allows you to scale your agents across multiple processes or hosts, and avoids the multithreading limitations of python’s GIL.</p> <p>See the <a href="https://github.com/operand/agency/tree/main/examples/demo/">example application</a> for a full working example.</p> <h2 id="configuring-amqp-connectivity"> <a href="#configuring-amqp-connectivity" class="anchor-heading" aria-labelledby="configuring-amqp-connectivity"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configuring AMQP Connectivity </h2> <p>By default, the <code class="language-plaintext highlighter-rouge">AMQPSpace</code> class will read the following environment variables and will otherwise use default settings.</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AMQP_HOST
AMQP_PORT
AMQP_USERNAME
AMQP_PASSWORD
AMQP_VHOST
</code></pre></div></div> <p>You may also customize the full list of options if you provide your own <code class="language-plaintext highlighter-rouge">AMQPOptions</code> object when instantiating an <code class="language-plaintext highlighter-rouge">AMQPSpace</code>. For example:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">space</span> <span class="o">=</span> <span class="n">AMQPSpace</span><span class="p">(</span>
    <span class="n">amqp_options</span><span class="o">=</span><span class="n">AMQPOptions</span><span class="p">(</span>
        <span class="n">hostname</span><span class="o">=</span><span class="s">"localhost"</span><span class="p">,</span>
        <span class="n">port</span><span class="o">=</span><span class="mi">5672</span><span class="p">,</span>
        <span class="n">username</span><span class="o">=</span><span class="s">"guest"</span><span class="p">,</span>
        <span class="n">password</span><span class="o">=</span><span class="s">"guest"</span><span class="p">,</span>
        <span class="n">virtual_host</span><span class="o">=</span><span class="s">"/"</span><span class="p">,</span>
        <span class="n">use_ssl</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">heartbeat</span><span class="o">=</span><span class="mi">60</span><span class="p">))</span>
</code></pre></div></div> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
