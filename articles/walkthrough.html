<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Example Application Walkthrough | Agency</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Example Application Walkthrough" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A fast and minimal framework for building agent-integrated systems" />
<meta property="og:description" content="A fast and minimal framework for building agent-integrated systems" />
<link rel="canonical" href="https://createwith.agency/articles/walkthrough.html" />
<meta property="og:url" content="https://createwith.agency/articles/walkthrough.html" />
<meta property="og:site_name" content="Agency" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Example Application Walkthrough" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"A fast and minimal framework for building agent-integrated systems","headline":"Example Application Walkthrough","url":"https://createwith.agency/articles/walkthrough.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://createwith.agency/feed.xml" title="Agency" /><!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-76DYGNV0GJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());

  gtag('config', 'G-76DYGNV0GJ');
</script>
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper">
    <a class="site-title" rel="author" href="/">
      Agency
    </a>
    <div class="site-nav">
      <a href="https://github.com/operand/agency">
        <svg class="svg-icon">
          <use xlink:href="/assets/minima-social-icons.svg#github"></use>
        </svg>
      </a>
    </div>
  </div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <div class="post-content">
    <h1 id="example-application-walkthrough">Example Application Walkthrough</h1>

<p>The following walkthrough will guide you through the basic concepts of Agency’s
API, and how to use it to build your own agent systems.</p>

<h2 id="creating-an-agency-application">Creating an Agency Application</h2>

<p>The snippet below is an example of a simple Agency application.</p>

<p>For this walkthrough, we’ll be using the <code class="language-plaintext highlighter-rouge">NativeSpace</code> class for connecting
agents. Usage is exactly the same as with the <code class="language-plaintext highlighter-rouge">AMQPSpace</code> class, except that a
<code class="language-plaintext highlighter-rouge">NativeSpace</code> is for agents in the same process, and does not require an AMQP
server.</p>

<p>The following application includes the <code class="language-plaintext highlighter-rouge">OpenAIFunctionAgent</code> class, a
transformers based chat agent named <code class="language-plaintext highlighter-rouge">ChattyAI</code>, operating system access, and a
Gradio based web application hosted at <code class="language-plaintext highlighter-rouge">http://localhost:8080</code>, all integrated
with the following implementation.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create a space
</span><span class="n">space</span> <span class="o">=</span> <span class="n">NativeSpace</span><span class="p">()</span>

<span class="c1"># Add a simple HF based chat agent to the space
</span><span class="n">space</span><span class="p">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">ChattyAI</span><span class="p">(</span><span class="s">"Chatty"</span><span class="p">,</span>
             <span class="n">model</span><span class="o">=</span><span class="s">"EleutherAI/gpt-neo-125m"</span><span class="p">))</span>

<span class="c1"># Add a host agent to the space, exposing access to the host system
</span><span class="n">space</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Host</span><span class="p">(</span><span class="s">"Host"</span><span class="p">))</span>

<span class="c1"># Add an OpenAI agent to the space
</span><span class="n">space</span><span class="p">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">OpenAIFunctionAgent</span><span class="p">(</span><span class="s">"FunctionAI"</span><span class="p">,</span>
                        <span class="n">model</span><span class="o">=</span><span class="s">"gpt-3.5-turbo-16k"</span><span class="p">,</span>
                        <span class="n">openai_api_key</span><span class="o">=</span><span class="n">os</span><span class="p">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">"OPENAI_API_KEY"</span><span class="p">),</span>
                        <span class="c1"># user_id determines the "user" role in the OpenAI chat API
</span>                        <span class="n">user_id</span><span class="o">=</span><span class="s">"User"</span><span class="p">))</span>

<span class="c1"># Connect the Gradio app user to the space
</span><span class="n">space</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">gradio_user</span><span class="p">)</span>

<span class="c1"># Launch Gradio UI
</span><span class="n">demo</span><span class="p">.</span><span class="n">launch</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="creating-a-space-and-adding-an-agent">Creating a Space and adding an Agent</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">space</span> <span class="o">=</span> <span class="n">NativeSpace</span><span class="p">()</span>
<span class="n">space</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">ChattyAI</span><span class="p">(</span><span class="s">"Chatty"</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s">"EleutherAI/gpt-neo-125m"</span><span class="p">))</span>
</code></pre></div></div>

<p>This creates a space and adds a new <code class="language-plaintext highlighter-rouge">ChattyAI</code> instance to it, with the <code class="language-plaintext highlighter-rouge">id</code> of
<code class="language-plaintext highlighter-rouge">Chatty</code>.</p>

<p>An agent’s <code class="language-plaintext highlighter-rouge">id</code> is used to identify the agent within the space. Other agents may
send messages to <code class="language-plaintext highlighter-rouge">Chatty</code> by using that <code class="language-plaintext highlighter-rouge">id</code>, as we’ll see later.</p>

<p><code class="language-plaintext highlighter-rouge">id</code>’s are unique. Two agents may not declare the same <code class="language-plaintext highlighter-rouge">id</code> within the same
space.</p>

<h2 id="defining-actions">Defining Actions</h2>

<p>Looking at <code class="language-plaintext highlighter-rouge">ChattyAI</code>’s source code, you’ll see that it is a subclass of
<code class="language-plaintext highlighter-rouge">Agent</code>, and that it exposes a single action called <code class="language-plaintext highlighter-rouge">say</code>.</p>

<p>The following is a typical action method signature taken from <code class="language-plaintext highlighter-rouge">ChattyAI</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">action</span>
<span class="k">def</span> <span class="nf">say</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="s">"""Use this action to say something to Chatty"""</span>
    <span class="p">...</span>
</code></pre></div></div>

<p>The decorator <code class="language-plaintext highlighter-rouge">@action</code> is used to indicate that this is an action that can be
invoked by other agents in their space. The method name <code class="language-plaintext highlighter-rouge">say</code> is the name of the
action by default.</p>

<p>The <code class="language-plaintext highlighter-rouge">say</code> action takes a single string argument <code class="language-plaintext highlighter-rouge">content</code>. This action is
intended to allow other agents to chat with Chatty, as expressed in its
docstring.</p>

<p>When <code class="language-plaintext highlighter-rouge">ChattyAI</code> receives a <code class="language-plaintext highlighter-rouge">say</code> action, it will generate a response using its
underlying language model, and return the result to the sender.</p>

<h2 id="invoking-actions">Invoking Actions</h2>

<p>An example of invoking an action can be seen here, taken from the same
<code class="language-plaintext highlighter-rouge">ChattyAI.say()</code> method.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">...</span>
<span class="bp">self</span><span class="p">.</span><span class="n">send</span><span class="p">({</span>
    <span class="s">"to"</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">_current_message</span><span class="p">[</span><span class="s">'from'</span><span class="p">],</span>
    <span class="s">"action"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">"name"</span><span class="p">:</span> <span class="s">"say"</span><span class="p">,</span>
        <span class="s">"args"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"content"</span><span class="p">:</span> <span class="n">response_content</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div>

<p>This demonstrates the basic idea of how to invoke an action on another agent.</p>

<p>When an agent receives a message, it invokes the action method specified by the
<code class="language-plaintext highlighter-rouge">action.name</code> field of the message, passing the <code class="language-plaintext highlighter-rouge">action.args</code> dictionary to the action
method as keyword arguments.</p>

<p>So here Chatty is invoking the <code class="language-plaintext highlighter-rouge">say</code> action on the sender of the original
message, passing the response as the <code class="language-plaintext highlighter-rouge">content</code> argument. This way, the original
sender and Chatty can have a conversation.</p>

<p>Note the use of the <code class="language-plaintext highlighter-rouge">_current_message</code> variable. That variable may be inspected
during an action to access the entire incoming message which invoked the action.</p>

<h2 id="access-control">Access Control</h2>

<p>Access policies may be used to control when actions can be invoked by agents.
All actions may declare an access policy like the following example:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">action</span><span class="p">(</span><span class="n">access_policy</span><span class="o">=</span><span class="n">ACCESS_PERMITTED</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="p">...</span>
</code></pre></div></div>

<p>An access policy can currently be one of three values:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">ACCESS_PERMITTED</code> - (Default) Permits any agent to use that action at
any time.</li>
  <li><code class="language-plaintext highlighter-rouge">ACCESS_DENIED</code> - Prevents access to that action.</li>
  <li><code class="language-plaintext highlighter-rouge">ACCESS_REQUESTED</code> - Prompts the receiving agent for permission when access is
attempted. Access will await approval or denial.</li>
</ul>

<p>If <code class="language-plaintext highlighter-rouge">ACCESS_REQUESTED</code> is used, the receiving agent will be prompted to approve
the action via the <code class="language-plaintext highlighter-rouge">request_permission()</code> callback method.</p>

<p>If any actions declare a policy of <code class="language-plaintext highlighter-rouge">ACCESS_REQUESTED</code>, you must implement the
<code class="language-plaintext highlighter-rouge">request_permission()</code> method with the following signature in order to receive
permission requests.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">request_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proposed_message</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="p">...</span>
</code></pre></div></div>

<p>Your implementation should inspect <code class="language-plaintext highlighter-rouge">proposed_message</code> and return a boolean
indicating whether or not to permit the action.</p>

<p>You can use this approach to protect against dangerous actions being taken. For
example if you allow terminal access, you may want to review commands before
they are invoked.</p>

<h2 id="the-gradio-ui">The Gradio UI</h2>

<p>The Gradio UI is a <a href="https://www.gradio.app/docs/chatbot"><code class="language-plaintext highlighter-rouge">Chatbot</code></a> based
application used for development and demonstration purposes, that allows human
users to connect to a space and chat with the connected agents.</p>

<p>It is defined in
<a href="https://github.com/operand/agency/tree/main/examples/demo/apps/gradio_app.py">examples/demo/apps/gradio_app.py</a> and
simply needs to be imported and used like so:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">apps.gradio_app</span> <span class="kn">import</span> <span class="n">demo</span><span class="p">,</span> <span class="n">gradio_user</span>
<span class="p">...</span>
<span class="n">space</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">gradio_user</span><span class="p">)</span>
<span class="p">...</span>
<span class="n">demo</span><span class="p">.</span><span class="n">launch</span><span class="p">()</span>
</code></pre></div></div>

<p>You can also invoke actions on agents using a custom “slash” syntax. To
broadcast a message to all other agents in the space, simply type without a
format. The client will automatically convert unformatted text to a <code class="language-plaintext highlighter-rouge">say</code>
action. For example, simply writing:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hello, world!
</code></pre></div></div>
<p>will be broadcast to all agents as a <code class="language-plaintext highlighter-rouge">say</code> action.</p>

<p>To send a point-to-point message to a specific agent, or to call actions other
than <code class="language-plaintext highlighter-rouge">say</code>, you can use the following format:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/agent_id.action_name arg1:"value 1" arg2:"value 2"
</code></pre></div></div>

<h2 id="adding-os-access-with-the-host-agent">Adding OS Access with the Host Agent</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">space</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Host</span><span class="p">(</span><span class="s">"Host"</span><span class="p">))</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">Host</code> class demonstrates allowing access to the host operating system where
the python application is running. It exposes actions such as <code class="language-plaintext highlighter-rouge">read_file</code> and
<code class="language-plaintext highlighter-rouge">shell_command</code> which allow other agents to interact with the host.</p>

<p>This class is a good example of one with potentially dangerous actions that must
be accessed with care. You’ll notice that all the methods in the <code class="language-plaintext highlighter-rouge">Host</code> class
have been given the access policy:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">action</span><span class="p">(</span><span class="n">access_policy</span><span class="o">=</span><span class="n">ACCESS_REQUESTED</span><span class="p">)</span>
<span class="p">...</span>
</code></pre></div></div>

<p>Thanks to the implementation of <code class="language-plaintext highlighter-rouge">request_permission()</code> in the <code class="language-plaintext highlighter-rouge">Host</code> class, all
actions on the host will require a confirmation from the terminal where the
application is being run.</p>

<p>Note that this implementation of <code class="language-plaintext highlighter-rouge">request_permission()</code> is just one possibility.
We could have implemented for example, a phone notification for a human to
review from elsewhere.</p>

<h2 id="discovering-actions">Discovering Actions</h2>

<p>At this point, we can demonstrate how action discovery works from the
perspective of a human user of the web application.</p>

<p>Once added to a space, each agent may broadcast a <code class="language-plaintext highlighter-rouge">help</code> message to discover
other agents and actions that are available in the space.</p>

<p>So a person using the chat UI can discover all available actions by typing:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/*.help
</code></pre></div></div>

<p>Note the use of <code class="language-plaintext highlighter-rouge">*</code>. This is a reserved name for broadcasting messages to all
agents in the space.</p>

<p>So the above command will broadcast a <code class="language-plaintext highlighter-rouge">help</code> action to all other agents, who
will individually respond with a dictionary of their available actions.</p>

<p>To invoke an action (like <code class="language-plaintext highlighter-rouge">help</code>) on a specific agent, you can use the following
syntax:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/Host.help action_name:"say"
</code></pre></div></div>

<p>Note the agent name used before the action name. In this case, the <code class="language-plaintext highlighter-rouge">help</code> action
takes an argument called <code class="language-plaintext highlighter-rouge">action_name</code>. So this will send the <code class="language-plaintext highlighter-rouge">help</code> action to
the <code class="language-plaintext highlighter-rouge">Host</code> agent requesting information on the <code class="language-plaintext highlighter-rouge">say</code> action.</p>

<h2 id="adding-an-intelligent-agent">Adding an Intelligent Agent</h2>

<p>Lastly we can add an intelligent agent into the space.</p>

<p>To add the <a href="https://github.com/operand/agency/tree/main/agency/agents/demo_agent.py"><code class="language-plaintext highlighter-rouge">OpenAIFunctionAgent</code></a> class to the
environment:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">space</span><span class="p">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">OpenAIFunctionAgent</span><span class="p">(</span><span class="s">"FunctionAI"</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="s">"gpt-3.5-turbo-16k"</span><span class="p">,</span>
        <span class="n">openai_api_key</span><span class="o">=</span><span class="n">os</span><span class="p">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">"OPENAI_API_KEY"</span><span class="p">),</span>
        <span class="c1"># user_id determines the "user" role in the chat API
</span>        <span class="n">user_id</span><span class="o">=</span><span class="s">"User"</span><span class="p">))</span>
</code></pre></div></div>

<p>For more agent examples that you can try, see the
<a href="https://github.com/operand/agency/tree/main/examples/demo/agents/"><code class="language-plaintext highlighter-rouge">examples/demo/agents/</code></a> directory.</p>

<p>That concludes the example walkthrough. To try the demo application, please jump
to the <a href="https://github.com/operand/agency/tree/main/examples/demo/">examples/demo/</a> directory.</p>

  </div>

</article>

      </div>
    </main>

  </body>

</html>
