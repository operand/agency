---
title: Agent Implementation
---

# Agent Implementation

This article assumes you have read the [Demo Walkthrough](./walkthrough.md)
article, and covers additional details regarding agent implementation.

## Defining Action Metadata

The `@action` decorator takes the following keyword arguments:

* `name`: The name of the action. Defaults to the method name
* `help`: The description of the action. Defaults to autogenerated object
* `access_policy`: The access policy of the action. Defaults to `ACCESS_PERMITTED`

### Defining Help

Below is an example of the help information generated by default from the
`@action` decorator. It uses the docstring of the method, and its signature
to generate the default help information.

```python
{
  "shell_command": {
    "description": "Execute a shell command",
    "args": {
      "command": {
        "type": "string"
        "description": "The command to execute"
      }
    },
    "returns": {
      "type": "string"
      "description": "The output of the command"
    }
  },
  ...
}
```

The following example shows how the same help information above can be defined
using a docstring that follows the [Google style
guide](https://github.com/google/styleguide/blob/gh-pages/pyguide.md#383-functions-and-methods):

```python
@action
def shell_command(self, command: str) -> str:
    """
    Execute a shell command

    Args:
        command (str): The command to execute

    Returns:
        str: The output of the command
    """
```

The action name is determined by the method name.

Types are determined by looking at the docstring and the signature, with the
signature type hint taking precedence.

Action and argument descriptions are parsed from the docstring.


### Overriding Help Information

The default help data structure described above can be overridden by supplying a
custom help object to the @action decorator.

```python
@action(
    help={
      "You": "can define",
      "any": {
        "structure": ["you", "want", "here."]
      }
    }
)
def say(self, content: str) -> None:
```

When a custom `help` object is provided, it overrides the generated object
entirely. You can use this to experiment with different help information
schemas.


## Using the `request()` Method for Synchronous Actions

The `Agent.request()` method is a synchronous version of the `send()` method
that allows you to call an action and receive its return value or exception
synchronously. If the action raises an exception an `ActionError` will be raised
containing the error message.

Here's an example of how you might call `request()`:

```python
try:
    return_value = self.request({
      "to": "ExampleAgent",
      "action": {
        "name": "example_action",
        "args": {
          "content": "hello"
        }
      }
    }, timeout=5)
except ActionError as e:
    print(e.message)
```

Note that `request()` may not be called during the `after_add()` and
`before_remove()` callbacks, but may be used within actions or other callbacks.


## Callbacks

The following list describes all available agent callbacks, with a link to their
API documentation. Please see the API documentation for more detailed
descriptions of these callbacks.

### [`after_add`](../api_docs/agency/agent.html#Agent.after_add)
Called after an agent is added to a space, but before it begins processing
messages.

### [`before_remove`](../api_docs/agency/agent.html#Agent.before_remove)
Called before an agent is removed from a space and will no longer process more
messages.

### [`handle_action_value`](../api_docs/agency/agent.html#Agent.handle_action_value)
If an action method returns a value, this method will be called with the value.

### [`handle_action_error`](../api_docs/agency/agent.html#Agent.handle_action_error)
Receives any error messages from an action invoked by the agent.

### [`before_action`](../api_docs/agency/agent.html#Agent.before_action)
Called before an action is attempted.

### [`after_action`](../api_docs/agency/agent.html#Agent.after_action)
Called after an action is attempted.

### [`request_permission`](../api_docs/agency/agent.html#Agent.request_permission)
Called when an agent attempts to perform an action that requires permission.
